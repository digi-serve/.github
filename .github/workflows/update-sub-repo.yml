name: Update Sub Repo
on:
  workflow_call:
    inputs:
      repository:
        description: Full sub repo name with organization
        required: true
        type: string
      short_name:
        description: Short name for the sub repo
        required: true
        type: string
     folder:
        description: Folder name for the sub repo in the main repo
        required: true
        type: string
      version:
        type: string
        required: true
    outputs:
      branch:
        value: ${{ jobs.update.outputs.branch }}

jobs:
  update:
    name: Update Sub Repo
    runs-on: ubuntu-latest
    outputs:
      branch: ${{ steps.set_branch.outputs.branch }}
    steps:
      - name: Set branch name
        id: set_branch
        env:
          SUB: ${{ inputs.short_name }}
          VERSION: ${{ inputs.version }}
        run: echo "branch=CI/update/$SUB-$VERSION" >> "$GITHUB_OUTPUT"

      - name: Checkout Repo
        uses: actions/checkout@v3
      
      - name: Checkout Sub Repo
        uses: actions/checkout@v3
        with:
          repository: ${{ inputs.repository }}
          path: ${{ inputs.folder }}
          ref: ${{ inputs.VERSION }}

      - name: Commit Change to New Branch
        id: commit_version
        uses: EndBug/add-and-commit@v9
        with:
          message: Update ${{ inputs.short_name }} to ${{ inputs.VERSION }}
          new_branch: ${{ steps.set_branch.outputs.branch }}
          default_author: github_actions
